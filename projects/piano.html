<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voltage-to-Frequency Piano - Project Details</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- MathJax for LaTeX support -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
    <div class="project-detail-container">
        <!-- Header -->
        <header class="detail-header">
            <div class="header-top">
                <a href="../index.html" class="btn btn-sm btn-glass back-btn"><i class="fa-solid fa-arrow-left"></i>
                    Back to Home</a>
            </div>
            <div class="header-main">
                <h1>Voltage-to-Frequency Piano</h1>
            </div>
            <div class="detail-meta">
                <span><i class="fa-regular fa-calendar"></i> Fall 2024</span>
                <span class="tech-tag">Analog Circuits</span>
                <span class="tech-tag">LTSpice</span>
                <span class="tech-tag">Signal Processing</span>
            </div>
        </header>

        <!-- Main Content Grid -->
        <div class="detail-grid">

            <!-- Description & Logic -->
            <!-- Introduction -->
            <section class="detail-section glass-panel">
                <h2>1. Introduction</h2>
                <div class="text-content">
                    <p>
                        This project focuses on building an electronic piano using analog components. The design
                        allows us to play 12 musical notes across a single octave, from A4 (440 Hz) to A5 (880 Hz).
                        The core idea is that each button on the keyboard produces a unique voltage, and that
                        voltage determines the pitch of the sound.
                    </p>
                    <p>
                        The design assumes that only one button is pressed at a time. This simplifies both the
                        hardware and the logic, and it makes the system easier to test. The range of notes was
                        chosen based on what the circuit can generate reliably, and the values for each component
                        were selected to keep the output stable and within the right frequency range.
                    </p>
                </div>
            </section>

            <!-- System Architecture -->
            <section class="detail-section glass-panel">
                <h2>2. System Architecture / Block Diagram</h2>
                <div class="text-content">
                    <p>
                        The system includes five main parts. First is the set of push-buttons, which acts as the
                        interface for playing notes. Each button is connected to a pin of an arduino micro that is
                        connected to the MCP4725 Digital to Analog Converter breakout board. The Vout of the
                        DAC, regulated through the arduino, goes into a voltage-to-frequency converter, which turns
                        it into a waveform with a corresponding frequency. From there the signal passes through an
                        audio amplifier and then into a speaker, which produces the sound.
                    </p>

                    <div class="technical-image-container"
                        style="margin-top: 2rem; background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                        <img src="../assets/images/piano/piano_block_diagram.png" alt="System Block Diagram"
                            style="width: 100%; max-width: 650px; display: block; margin: 0 auto; border-radius: 4px;">
                        <p class="caption"
                            style="text-align: center; color: var(--text-secondary); margin-top: 0.5rem; font-size: 0.9rem;">
                            Figure 1: Block diagram of the full system. Each button generates a voltage corresponding to
                            a
                            musical note, which is converted into a frequency, amplified, and played through a speaker.
                        </p>
                    </div>
                </div>
            </section>

            <!-- Theoretical Analysis -->
            <section class="detail-section glass-panel">
                <h2>3. Theoretical Analysis</h2>
                <div class="text-content">
                    <h3>Key Input Interface and DAC</h3>
                    <p>
                        While our original design at first implemented a simple resistor ladder as the DAC, we
                        pivoted to a more integrated approach by using an Arduino Micro board interfaced with a
                        separate MCP4725 DAC chip. The primary reason we pivoted is because the digital DAC
                        is able to specify our target voltage with extreme precision given the C++ code we wrote
                        in the Arduino sketch. In this scenario, each button is fed into a data pin on the micro,
                        which is then processed to output a constant voltage. Our DAC and its wired configuration
                        is detailed below.
                    </p>

                    <!-- Digital DAC Module Image -->
                    <div class="technical-image-container"
                        style="margin-top: 2rem; margin-bottom: 2rem; background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                        <img src="../assets/images/piano/digital_dac_module.png" alt="Digital DAC Module"
                            style="width: 100%; max-width: 500px; display: block; margin: 0 auto; border-radius: 4px;">
                        <p class="caption"
                            style="text-align: center; color: var(--text-secondary); margin-top: 0.5rem; font-size: 0.9rem;">
                            Figure 2: Digital DAC Module<br>
                            The purpose of this block is to generate a unique DC voltage for each note/button. These DC
                            voltages and their corresponding frequencies and notes are summarized in the table below
                            when testing the actual circuit.
                        </p>
                    </div>

                    <!-- Frequency Table -->
                    <div class="table-container" style="overflow-x: auto;">
                        <table
                            style="width: 100%; border-collapse: collapse; margin-top: 1rem; color: var(--text-primary);">
                            <thead>
                                <tr style="background: rgba(255,255,255,0.1); text-align: left;">
                                    <th style="padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1);">Note</th>
                                    <th style="padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1);">Frequency
                                        (Hz)</th>
                                    <th style="padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                        V<sub>Out</sub> (V)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                        A<sub>4</sub></td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">440</td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">0.35</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                        A#<sub>4</sub>/B♭<sub>4</sub></td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">466</td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">0.37</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                        B<sub>4</sub></td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">494</td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">0.39</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                        C<sub>5</sub></td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">523</td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">0.42</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                        C#<sub>5</sub>/D♭<sub>5</sub></td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">554</td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">0.45</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                        D<sub>5</sub></td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">587</td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">0.475
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                        D#<sub>5</sub>/E♭<sub>5</sub></td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">622</td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">0.505
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                        E<sub>5</sub></td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">659</td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">0.535
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                        F<sub>5</sub></td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">698</td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">0.575
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                        F#<sub>5</sub>/G♭<sub>5</sub></td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">740</td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">0.615
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                        G<sub>5</sub></td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">784</td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">0.65</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                        G#<sub>5</sub>/A♭<sub>5</sub></td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">831</td>
                                    <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);">0.70</td>
                                </tr>
                            </tbody>
                        </table>
                        <p class="caption"
                            style="text-align: center; color: var(--text-secondary); margin-top: 0.5rem; font-size: 0.9rem;">
                            Table 1: DAC design for 5th octave
                        </p>
                    </div>

                    <div style="margin-top: 4rem;"></div>

                    <!-- V2F Section -->
                    <h3>Voltage-to-Frequency Converter</h3>
                    <p>
                        The voltage-to-frequency converter is the core of the system. It uses a relaxation oscillator
                        built from two op-amps: an integrator and a Schmitt trigger comparator. The integrator
                        charges a capacitor linearly, and the comparator resets it via a diode once a threshold is
                        reached. This produces a sawtooth waveform whose frequency increases with input voltage.
                        Shown below is the schematic of the circuit that we utilized for the design:
                    </p>

                    <!-- V2F Schematic -->
                    <div class="technical-image-container"
                        style="margin-top: 2rem; margin-bottom: 2rem; background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                        <img src="../assets/images/piano/v2f_schematic.png" alt="V2F Schematic"
                            style="width: 100%; max-width: 650px; display: block; margin: 0 auto; border-radius: 4px;">
                        <p class="caption"
                            style="text-align: center; color: var(--text-secondary); margin-top: 0.5rem; font-size: 0.9rem;">
                            Figure 3: Voltage-to-Frequency Converter Schematic
                        </p>
                    </div>

                    <p>
                        To begin with analysis of this circuit, we treat one complete cycle as two linear phases: with
                        the diode state indicated as below.
                    </p>

                    <!-- Phases Table -->
                    <div class="table-container" style="overflow-x: auto; margin-bottom: 2rem;">
                        <table
                            style="width: 100%; border-collapse: collapse; margin-top: 1rem; color: var(--text-primary);">
                            <thead>
                                <tr style="background: rgba(255,255,255,0.1);">
                                    <th style="padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                        Comparator output</th>
                                    <th style="padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1);">Diode
                                        state</th>
                                    <th style="padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                        Integrator slope \(\dot{V}_x\)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                        \(V_{out} = +V_{CC}\)</td>
                                    <td style="padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05);">OFF</td>
                                    <td
                                        style="padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 1.1em;">
                                        \(\dot{V}_x = -\frac{V_{in}}{R_1 C}\)
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                        \(V_{out} = -V_{CC}\)</td>
                                    <td style="padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05);">ON</td>
                                    <td
                                        style="padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 1.1em;">
                                        \(\dot{V}_x = -\frac{V_{in}}{R_1 C} - \frac{V_{out}}{R_2 C} = \frac{V_{CC}}{R_2
                                        C} - \frac{V_{in}}{R_1 C}\)
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <p>
                        The slopes follow directly from KCL at the integrator summing-node (\(V_x\) is the integrator
                        output):
                    </p>

                    <div style="font-size: 1.25rem; margin: 1.5rem 0; text-align: center;">
                        $$ \frac{V_{in}}{R_1} + \frac{V_{out}}{R_2} + C\dot{V}_x = 0 \implies \dot{V}_x = -
                        \frac{V_{in}}{R_1 C} - \frac{V_{out}}{R_2 C} $$
                    </div>

                    <p>
                        <strong>Schmitt-trigger thresholds.</strong> With the non-inverting input of the second op-amp
                        tied to the divider \(R_3-R_4\),
                    </p>

                    <div style="font-size: 1.25rem; margin: 1.5rem 0; text-align: center;">
                        $$ 0 = V_+ = \frac{R_4}{R_3 + R_4}V_x + \frac{R_3}{R_3 + R_4}V_{out} \implies V_x = \pm
                        \frac{R_3}{R_4}V_{CC} \equiv \pm V_H $$
                    </div>

                    <p>
                        Hence the triangular ramp swings between \(\pm V_H\) with
                    </p>

                    <div style="font-size: 1.25rem; margin: 1.5rem 0; text-align: center;">
                        $$ V_H = \frac{R_3}{R_4}V_{CC}, \quad \Delta V = 2V_H. $$
                    </div>

                    <p><strong>Time per phase.</strong></p>
                    <div style="font-size: 1.25rem; margin: 1.5rem 0; text-align: center;">
                        $$ t_{OFF} = \frac{\Delta V}{|\dot{V}_x|_{OFF}} = \frac{2V_H R_1 C}{V_{in}}, $$
                        $$ t_{ON} = \frac{\Delta V}{\dot{V}_x|_{ON}} = \frac{2V_H C}{\frac{V_{CC}}{R_2} -
                        \frac{V_{in}}{R_1}} = \frac{2V_H C R_1 R_2}{V_{CC}R_1 - V_{in}R_2}. $$
                    </div>

                    <p><strong>Period and frequency.</strong> Adding the two intervals,</p>
                    <div style="font-size: 1.25rem; margin: 1.5rem 0; text-align: center;">
                        $$ T = t_{OFF} + t_{ON} = 2V_H C \left[ \frac{R_1}{V_{in}} + \frac{R_1 R_2}{V_{CC}R_1 -
                        V_{in}R_2} \right] = \frac{2V_H C V_{CC} R_1^2}{V_{in}(V_{CC}R_1 - V_{in}R_2)}. $$
                    </div>

                    <p>Substituting \(V_H\) and inverting gives the frequency:</p>

                    <!-- Boxed Equation -->
                    <div
                        style="font-size: 1.5rem; margin: 2rem auto; text-align: center; border: 2px solid var(--accent-primary); padding: 1.5rem; border-radius: 12px; width: fit-content; background: rgba(255,255,255,0.05); box-shadow: 0 0 20px rgba(56, 189, 248, 0.2);">
                        $$ f(V_{in}) = \frac{1}{T} = \frac{R_4 V_{in}}{2R_1 R_3 C V_{CC}} - \frac{R_2 R_4 V_{in}^2}{2
                        R_1^2 R_3 C V_{CC}^2} $$
                    </div>

                    <p>
                        Thus, with this equation we were able to design given components for our circuit. With that
                        being
                        said, we picked the following values for each of our components: \(V_{CC} = 5V, R_1 =
                        100k\Omega, R_2 = 50k\Omega, R_3 = 10k\Omega, R_4 = 100k\Omega,\) and \(C = 10nF\). This
                        produces the following
                        expression for frequency as a function of voltage:
                    </p>

                    <div style="font-size: 1.25rem; margin: 1.5rem 0; text-align: center;">
                        $$ f(V_{in}) = 1000V_{in} - 1000V_{in}^2 $$
                    </div>

                    <p>
                        Next, we needed to process this signal a bit by cutting off certain frequencies while also
                        amplifying the signal. To do this, we first implemented a low pass filter, of which the
                        schematic
                        is shown below in Figure 4.
                    </p>

                    <!-- Low Pass Filter Schematic -->
                    <div class="technical-image-container"
                        style="margin-top: 2rem; margin-bottom: 2rem; background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                        <img src="../assets/images/piano/lowpass_filter_schematic.png" alt="Low Pass Filter Schematic"
                            style="width: 100%; max-width: 400px; display: block; margin: 0 auto; border-radius: 4px;">
                        <p class="caption"
                            style="text-align: center; color: var(--text-secondary); margin-top: 0.5rem; font-size: 0.9rem;">
                            Figure 4: Schematic of Low Pass Filter
                        </p>
                    </div>

                    <p>
                        The cutoff frequency for the low pass filter is well known, so we won't be including a full
                        derivation. That being said the relationship ends up being \(f_{cutoff} = \frac{1}{2\pi RC}\).
                        In this case
                        we are targeting the 5th octave (440 Hz - 831 Hz). As such, we decided to cutoff at a bit
                        above the highest frequency, so we chose \(f_{cutoff} = 1\text{ kHz}\). Thus, given the above
                        relationship
                        for cutoff frequency in a low pass filter, we designed the components of the filter to be the
                        following values: \(R = 10k\Omega\) and \(C = 15nF\).
                    </p>

                    <p>
                        Finally, we wanted to amplify our signal such that we get a loud enough sound to be played.
                        To do this, we implemented a non-inverting amplifier using another op-amp. The schematic for
                        this circuit is shown below in Figure 5.
                    </p>

                    <!-- Non-Inverting Amplifier Schematic -->
                    <div class="technical-image-container"
                        style="margin-top: 2rem; margin-bottom: 2rem; background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                        <img src="../assets/images/piano/noninverting_amp_schematic.png"
                            alt="Non-Inverting Amplifier Schematic"
                            style="width: 100%; max-width: 400px; display: block; margin: 0 auto; border-radius: 4px;">
                        <p class="caption"
                            style="text-align: center; color: var(--text-secondary); margin-top: 0.5rem; font-size: 0.9rem;">
                            Figure 5: Non-Inverting Amplifier Schematic
                        </p>
                    </div>

                    <p>
                        Again, the gain of the non-inverting amplifier is well-known, so we won't be including a full
                        derivation. That being said, the gain abides by the following relationship: \(A_v = 1 +
                        \frac{R_1}{R_2}\).
                        We thought a gain of 5 would be a reasonable amplification factor as to make the produced
                        sound just loud enough that it would be pleasant for the ears. As such, we designed our
                        values for each resistor to then be: \(R_1 = 3k\Omega\) and \(R_2 = 750\Omega\).
                    </p>

                    <p>
                        The final circuit was then constructed and we arrived at the final schematic with each of our
                        designed values, which is shown below in Figure 6.
                    </p>

                    <!-- Full V2F Schematic -->
                    <div class="technical-image-container"
                        style="margin-top: 2rem; margin-bottom: 2rem; background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                        <img src="../assets/images/piano/full_v2f_schematic.png"
                            alt="Full V2F Schematic with Post Processing"
                            style="width: 100%; max-width: 750px; display: block; margin: 0 auto; border-radius: 4px;">
                        <p class="caption"
                            style="text-align: center; color: var(--text-secondary); margin-top: 0.5rem; font-size: 0.9rem;">
                            Figure 6: Full Voltage-to-Frequency Converter Schematic with Post Processing
                        </p>
                    </div>

                </div>
            </section>

            <!-- Section 4: Simulations -->
            <section class="detail-section glass-panel">
                <h2>4. Simulations</h2>
                <div class="text-content">
                    <p>
                        We tested the circuit using LTspice with input voltages corresponding to three representative
                        notes: A, B, and C. Each of the notes correspond to specific frequency and voltage as summarized
                        in Table 1. The waveforms generated in simulation closely matched our expectations.
                        These simulations are displayed below in Figures 7, 8 and 9.
                    </p>

                    <!-- Simulation A -->
                    <div class="technical-image-container"
                        style="margin-top: 2rem; margin-bottom: 2rem; background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                        <img src="../assets/images/piano/sim_note_a.png" alt="Simulating A Note"
                            style="width: 100%; max-width: 800px; display: block; margin: 0 auto; border-radius: 4px;">
                        <p class="caption"
                            style="text-align: center; color: var(--text-secondary); margin-top: 0.5rem; font-size: 0.9rem;">
                            Figure 7: Simulating A Note
                        </p>
                    </div>

                    <!-- Simulation B -->
                    <div class="technical-image-container"
                        style="margin-top: 2rem; margin-bottom: 2rem; background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                        <img src="../assets/images/piano/sim_note_b.png" alt="Simulating B Note"
                            style="width: 100%; max-width: 800px; display: block; margin: 0 auto; border-radius: 4px;">
                        <p class="caption"
                            style="text-align: center; color: var(--text-secondary); margin-top: 0.5rem; font-size: 0.9rem;">
                            Figure 8: Simulating B Note
                        </p>
                    </div>

                    <!-- Simulation C -->
                    <div class="technical-image-container"
                        style="margin-top: 2rem; margin-bottom: 2rem; background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                        <img src="../assets/images/piano/sim_note_c.png" alt="Simulating C Note"
                            style="width: 100%; max-width: 800px; display: block; margin: 0 auto; border-radius: 4px;">
                        <p class="caption"
                            style="text-align: center; color: var(--text-secondary); margin-top: 0.5rem; font-size: 0.9rem;">
                            Figure 9: Simulating C Note
                        </p>
                    </div>
                </div>
            </section>

            <!-- Section 5: Implementation -->
            <section class="detail-section glass-panel">
                <h2>5. Implementation</h2>
                <div class="text-content">
                    <h3>Amplifier and Speaker</h3>
                    <p>
                        We used an LM386 audio amplifier to drive the speaker. The gain was configured via a
                        capacitor between pins 1 and 8, and the input/output were AC-coupled to remove DC
                        offset. The entire system was powered by the lab bench supply.
                    </p>

                    <h3>Breadboard Integration</h3>
                    <p>
                        All subsystems were assembled on three breadboards. One containing the buttons, whose
                        ground and power were directly connected to a half-breadboard that contain the Arduino
                        Micro and DAC. The V<sub>Out</sub> of the DAC was directly connected to V<sub>in</sub> of our
                        V2F. Also, after
                        our V2F, we have a low pass filter consisting of another UA741 op-amp and two resistors, 3
                        kΩ and 750 Ω. Special attention was paid to grounding and wire layout to minimize
                        signal issues.
                    </p>
                </div>
            </section>

            <!-- Section 6: Code -->
            <section class="detail-section glass-panel">
                <h2>6. Code</h2>
                <div class="text-content">
                    <p>
                        The following Arduino sketch interfaces an MCP4725 digital-to-analog converter (via
                        the Adafruit MCP4725 library) and produces discrete output voltages selected by 12 input
                        buttons.
                    </p>

                    <!-- Code Block -->
                    <div
                        style="margin-top: 2rem; background: #1e1e1e; border-radius: 12px; padding: 1.5rem; overflow-x: auto; font-family: 'Fira Code', 'Consolas', monospace; font-size: 0.85rem; line-height: 1.6; border: 1px solid rgba(255,255,255,0.1);">
                        <pre style="margin: 0; color: #d4d4d4;"><code><span style="color: #c586c0;">#include</span> <span style="color: #ce9178;">&lt;Wire.h&gt;</span>
<span style="color: #c586c0;">#include</span> <span style="color: #ce9178;">&lt;Adafruit_MCP4725.h&gt;</span>

<span style="color: #4ec9b0;">Adafruit_MCP4725</span> dac;  <span style="color: #6a9955;">// Create DAC object</span>

<span style="color: #569cd6;">const float</span> vcc = <span style="color: #b5cea8;">5.00</span>;  <span style="color: #6a9955;">// DAC supply voltage</span>

<span style="color: #569cd6;">const int</span> button1 = <span style="color: #b5cea8;">12</span>;
<span style="color: #569cd6;">const int</span> button2 = <span style="color: #b5cea8;">11</span>;
<span style="color: #569cd6;">const int</span> button3 = <span style="color: #b5cea8;">10</span>;
<span style="color: #569cd6;">const int</span> button4 = <span style="color: #b5cea8;">9</span>;
<span style="color: #569cd6;">const int</span> button5 = <span style="color: #b5cea8;">8</span>;
<span style="color: #569cd6;">const int</span> button6 = <span style="color: #b5cea8;">7</span>;
<span style="color: #569cd6;">const int</span> button7 = <span style="color: #b5cea8;">6</span>;
<span style="color: #569cd6;">const int</span> button8 = <span style="color: #b5cea8;">5</span>;
<span style="color: #569cd6;">const int</span> button9 = <span style="color: #b5cea8;">4</span>;
<span style="color: #569cd6;">const int</span> button10 = <span style="color: #b5cea8;">1</span>;
<span style="color: #569cd6;">const int</span> button11 = <span style="color: #b5cea8;">0</span>;
<span style="color: #569cd6;">const int</span> button12 = <span style="color: #b5cea8;">16</span>;

<span style="color: #569cd6;">void</span> <span style="color: #dcdcaa;">setup</span>() {
    Serial.<span style="color: #dcdcaa;">begin</span>(<span style="color: #b5cea8;">9600</span>);
    dac.<span style="color: #dcdcaa;">begin</span>(<span style="color: #b5cea8;">0x60</span>);

    <span style="color: #dcdcaa;">pinMode</span>(button1, INPUT_PULLUP);
    <span style="color: #dcdcaa;">pinMode</span>(button2, INPUT_PULLUP);
    <span style="color: #dcdcaa;">pinMode</span>(button3, INPUT_PULLUP);
    <span style="color: #dcdcaa;">pinMode</span>(button4, INPUT_PULLUP);
    <span style="color: #dcdcaa;">pinMode</span>(button5, INPUT_PULLUP);
    <span style="color: #dcdcaa;">pinMode</span>(button6, INPUT_PULLUP);
    <span style="color: #dcdcaa;">pinMode</span>(button7, INPUT_PULLUP);
    <span style="color: #dcdcaa;">pinMode</span>(button8, INPUT_PULLUP);
    <span style="color: #dcdcaa;">pinMode</span>(button9, INPUT_PULLUP);
    <span style="color: #dcdcaa;">pinMode</span>(button10, INPUT_PULLUP);
    <span style="color: #dcdcaa;">pinMode</span>(button11, INPUT_PULLUP);
    <span style="color: #dcdcaa;">pinMode</span>(button12, INPUT_PULLUP);

    <span style="color: #dcdcaa;">pinMode</span>(LED_BUILTIN, OUTPUT);
}

<span style="color: #569cd6;">void</span> <span style="color: #dcdcaa;">loop</span>() {
    <span style="color: #c586c0;">if</span> (<span style="color: #dcdcaa;">digitalRead</span>(button1) == LOW) <span style="color: #dcdcaa;">outputVoltage</span>(<span style="color: #b5cea8;">0.35</span>, <span style="color: #b5cea8;">1</span>);
    <span style="color: #c586c0;">else if</span> (<span style="color: #dcdcaa;">digitalRead</span>(button2) == LOW) <span style="color: #dcdcaa;">outputVoltage</span>(<span style="color: #b5cea8;">0.37</span>, <span style="color: #b5cea8;">2</span>);
    <span style="color: #c586c0;">else if</span> (<span style="color: #dcdcaa;">digitalRead</span>(button3) == LOW) <span style="color: #dcdcaa;">outputVoltage</span>(<span style="color: #b5cea8;">0.39</span>, <span style="color: #b5cea8;">3</span>);
    <span style="color: #c586c0;">else if</span> (<span style="color: #dcdcaa;">digitalRead</span>(button4) == LOW) <span style="color: #dcdcaa;">outputVoltage</span>(<span style="color: #b5cea8;">0.42</span>, <span style="color: #b5cea8;">4</span>);
    <span style="color: #c586c0;">else if</span> (<span style="color: #dcdcaa;">digitalRead</span>(button5) == LOW) <span style="color: #dcdcaa;">outputVoltage</span>(<span style="color: #b5cea8;">0.45</span>, <span style="color: #b5cea8;">5</span>);
    <span style="color: #c586c0;">else if</span> (<span style="color: #dcdcaa;">digitalRead</span>(button6) == LOW) <span style="color: #dcdcaa;">outputVoltage</span>(<span style="color: #b5cea8;">0.475</span>, <span style="color: #b5cea8;">6</span>);
    <span style="color: #c586c0;">else if</span> (<span style="color: #dcdcaa;">digitalRead</span>(button7) == LOW) <span style="color: #dcdcaa;">outputVoltage</span>(<span style="color: #b5cea8;">0.505</span>, <span style="color: #b5cea8;">7</span>);
    <span style="color: #c586c0;">else if</span> (<span style="color: #dcdcaa;">digitalRead</span>(button8) == LOW) <span style="color: #dcdcaa;">outputVoltage</span>(<span style="color: #b5cea8;">0.535</span>, <span style="color: #b5cea8;">8</span>);
    <span style="color: #c586c0;">else if</span> (<span style="color: #dcdcaa;">digitalRead</span>(button9) == LOW) <span style="color: #dcdcaa;">outputVoltage</span>(<span style="color: #b5cea8;">0.575</span>, <span style="color: #b5cea8;">9</span>);
    <span style="color: #c586c0;">else if</span> (<span style="color: #dcdcaa;">digitalRead</span>(button10) == LOW) <span style="color: #dcdcaa;">outputVoltage</span>(<span style="color: #b5cea8;">0.650</span>, <span style="color: #b5cea8;">10</span>);
    <span style="color: #c586c0;">else if</span> (<span style="color: #dcdcaa;">digitalRead</span>(button11) == LOW) <span style="color: #dcdcaa;">outputVoltage</span>(<span style="color: #b5cea8;">0.615</span>, <span style="color: #b5cea8;">11</span>);
    <span style="color: #c586c0;">else if</span> (<span style="color: #dcdcaa;">digitalRead</span>(button12) == LOW) <span style="color: #dcdcaa;">outputVoltage</span>(<span style="color: #b5cea8;">0.700</span>, <span style="color: #b5cea8;">12</span>);
    <span style="color: #c586c0;">else</span> {
        dac.<span style="color: #dcdcaa;">setVoltage</span>(<span style="color: #b5cea8;">0</span>, <span style="color: #569cd6;">false</span>);
        <span style="color: #dcdcaa;">digitalWrite</span>(LED_BUILTIN, LOW);
    }
    <span style="color: #dcdcaa;">delay</span>(<span style="color: #b5cea8;">10</span>);
}

<span style="color: #569cd6;">void</span> <span style="color: #dcdcaa;">outputVoltage</span>(<span style="color: #569cd6;">float</span> vout, <span style="color: #569cd6;">int</span> buttonNum) {
    <span style="color: #4ec9b0;">uint16_t</span> code = (vout / vcc) * <span style="color: #b5cea8;">4095.0</span> + <span style="color: #b5cea8;">0.5</span>;  <span style="color: #6a9955;">// Conversion</span>
    dac.<span style="color: #dcdcaa;">setVoltage</span>(code, <span style="color: #569cd6;">false</span>);
    <span style="color: #dcdcaa;">digitalWrite</span>(LED_BUILTIN, HIGH);
    Serial.<span style="color: #dcdcaa;">print</span>(<span style="color: #ce9178;">"Button "</span>);
    Serial.<span style="color: #dcdcaa;">print</span>(buttonNum);
    Serial.<span style="color: #dcdcaa;">print</span>(<span style="color: #ce9178;">" pressed. Output voltage: "</span>);
    Serial.<span style="color: #dcdcaa;">print</span>(vout, <span style="color: #b5cea8;">3</span>);
    Serial.<span style="color: #dcdcaa;">println</span>(<span style="color: #ce9178;">" V"</span>);
}</code></pre>
                    </div>
                    <p class="caption"
                        style="text-align: center; color: var(--text-secondary); margin-top: 1rem; font-size: 0.9rem;">
                        Listing 1: Full Arduino sketch that interfaces an MCP4725 DAC and produces discrete output
                        voltages selected by 12 input buttons
                    </p>
                </div>
            </section>

            <!-- Figure 10: Circuit Overview -->
            <section class="detail-section glass-panel">
                <h2>Circuit Overview</h2>
                <div class="text-content">
                    <div class="technical-image-container"
                        style="margin-top: 1rem; margin-bottom: 2rem; background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                        <img src="../assets/images/piano/circuitoverview.png" alt="Circuit Overhead View"
                            style="width: 100%; max-width: 900px; display: block; margin: 0 auto; border-radius: 4px;">
                        <p class="caption"
                            style="text-align: center; color: var(--text-secondary); margin-top: 0.5rem; font-size: 0.9rem;">
                            Figure 10: Entire Circuit Overhead View
                        </p>
                    </div>

                    <!-- Figure 11: Oscilloscope Capture -->
                    <div class="technical-image-container"
                        style="margin-top: 2rem; margin-bottom: 2rem; background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                        <img src="../assets/images/piano/oscilloscopecapture.png" alt="Oscilloscope Capture"
                            style="width: 100%; max-width: 900px; display: block; margin: 0 auto; border-radius: 4px;">
                        <p class="caption"
                            style="text-align: center; color: var(--text-secondary); margin-top: 0.5rem; font-size: 0.9rem;">
                            Figure 11: Oscilloscope capture of the voltage-to-frequency (V2F) converter output. The
                            yellow trace (Channel 1) shows the triangle wave generated by the integrator stage (output
                            of
                            the first UA741 op-amp). The blue trace (Channel 2) displays the corresponding square wave
                            output from the comparator stage (second UA741 op-amp). The measured output frequency
                            is approximately 833 Hz (Testing the waveform using the G Sharp Key), corresponding to
                            the input DAC voltage.
                        </p>
                    </div>
                </div>
            </section>

            <!-- Section 7: Conclusion -->
            <section class="detail-section glass-panel">
                <h2>7. Conclusion</h2>
                <div class="text-content">
                    <p>
                        The final circuit successfully produced 12 playable notes using analog components. The
                        DAC generated stable voltages, the voltage-to-frequency converter output frequencies in the
                        correct range, and the amplifier delivered clear signals to the speaker. All modules worked
                        together with minimal integration issues.
                    </p>
                </div>
            </section>

        </div>
</body>

</html>